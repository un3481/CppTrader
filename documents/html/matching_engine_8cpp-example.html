<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>CppTrader: matching_engine.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">CppTrader
   &#160;<span id="projectnumber">1.0.2.0</span>
   </div>
   <div id="projectbrief">C++ Trader</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">matching_engine.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Matching engine example</p>
<div class="fragment"><div class="line"><span class="comment">/* a server in the unix domain */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="market__manager_8h.html">trader/matching/market_manager.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;OptionParser.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;system/stream.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;filesystem/file.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;sys/un.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/wait.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/resource.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/socket.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;vector&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;regex&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">extern</span> <span class="stringliteral">&quot;C&quot;</span> {</div>
<div class="line"><span class="preprocessor">    #include &lt;sqlite3/sqlite3.h&gt;</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>CppCommon;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code" href="namespace_cpp_trader_1_1_matching.html">CppTrader::Matching</a>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Preprocessed */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define VERSION &quot;2.2.1.2&quot; // Program version</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MSG_SIZE 256 // Buffer size for messages on socket stream (bytes)</span></div>
<div class="line"><span class="preprocessor">#define MSG_SIZE_SMALL 64 // Buffer size for small messages on socket stream (bytes)</span></div>
<div class="line"><span class="preprocessor">#define MSG_SIZE_LARGE 1024 // Buffer size for large messages on socket stream (bytes)</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define MAX_CLIENTS 64 // Max number of simultaneous clients connected to socket</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Constants */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> uint64_t SYMBOL_ID = 1; <span class="comment">// Symbol Id for the Order Book</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> std::string STATUS_RUN = <span class="stringliteral">&quot;RUNNING&quot;</span>; <span class="comment">// Daemon status (RUN)</span></div>
<div class="line"><span class="keyword">const</span> std::string STATUS_GSTOP = <span class="stringliteral">&quot;GRACEFULLY_STOPPED&quot;</span>; <span class="comment">// Daemon status (GSTOP)</span></div>
<div class="line"><span class="keyword">const</span> std::string STATUS_ABEND = <span class="stringliteral">&quot;ABEND&quot;</span>; <span class="comment">// Daemon status (ABEND)</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> std::string EMPTY_STR = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// Empty String</span></div>
<div class="line"><span class="keyword">const</span> std::string NULL_STR = <span class="stringliteral">&quot;NULL&quot;</span>; <span class="comment">// Null String</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> std::string CSV_SEP = <span class="stringliteral">&quot;,&quot;</span>; <span class="comment">// CSV separator</span></div>
<div class="line"><span class="keyword">const</span> std::string CSV_EOL = <span class="stringliteral">&quot;\n&quot;</span>; <span class="comment">// CSV end of line</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Enums Mapping</span></div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* LEVEL_TYPES[] = {<span class="stringliteral">&quot;BID&quot;</span>,<span class="stringliteral">&quot;ASK&quot;</span>};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* ORDER_SIDES[] = {<span class="stringliteral">&quot;BUY&quot;</span>,<span class="stringliteral">&quot;SELL&quot;</span>};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* ORDER_TYPES[] = {<span class="stringliteral">&quot;MARKET&quot;</span>,<span class="stringliteral">&quot;LIMIT&quot;</span>,<span class="stringliteral">&quot;STOP&quot;</span>,<span class="stringliteral">&quot;STOP_LIMIT&quot;</span>,<span class="stringliteral">&quot;TRAILING_STOP&quot;</span>,<span class="stringliteral">&quot;TRAILING_STOP_LIMIT&quot;</span>};</div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* ORDER_TIFS[] = {<span class="stringliteral">&quot;GTC&quot;</span>,<span class="stringliteral">&quot;IOC&quot;</span>,<span class="stringliteral">&quot;FOK&quot;</span>,<span class="stringliteral">&quot;AON&quot;</span>};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Order CSV Header</span></div>
<div class="line"><span class="keyword">const</span> std::string CSV_HEADER_FOR_ORDER = (</div>
<div class="line">    <span class="stringliteral">&quot;Id&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;SymbolId&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;Type&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;Side&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;Price&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;StopPrice&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;Quantity&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;TimeInForce&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;MaxVisibleQuantity&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;Slippage&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;TrailingDistance&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;TrailingStep&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;ExecutedQuantity&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;LeavesQuantity&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Order Book CSV Header</span></div>
<div class="line"><span class="keyword">const</span> std::string CSV_HEADER_FOR_BOOK = (</div>
<div class="line">    <span class="stringliteral">&quot;Group&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;LevelType&quot;</span> + CSV_SEP +</div>
<div class="line">    <span class="stringliteral">&quot;LevelPrice&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create Orders Table Query</span></div>
<div class="line"><span class="keyword">const</span> std::string QUERY_CREATE_TABLE_ORDERS = (EMPTY_STR +</div>
<div class="line">    <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS orders (&quot;</span> +</div>
<div class="line">        <span class="stringliteral">&quot;Id INT PRIMARY KEY NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;SymbolId TINYINT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Type TINYINT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Side TINYINT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Price INT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;StopPrice INT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Quantity INT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;TimeInForce TINYINT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;MaxVisibleQuantity INT&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Slippage INT&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;TrailingDistance INT&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;TrailingStep INT&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;ExecutedQuantity INT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;LeavesQuantity INT NOT NULL&quot;</span> + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Info CHAR(300) NOT NULL&quot;</span> +</div>
<div class="line">    <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create Latest Table Query</span></div>
<div class="line"><span class="keyword">const</span> std::string QUERY_CREATE_TABLE_LATEST = (</div>
<div class="line">    <span class="stringliteral">&quot;CREATE TABLE IF NOT EXISTS latest (Id INT NOT NULL)&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Populate Latest Table Query</span></div>
<div class="line"><span class="keyword">const</span> std::string QUERY_INSERT_INTO_LATEST = (EMPTY_STR +</div>
<div class="line">    <span class="stringliteral">&quot;INSERT INTO latest (Id) SELECT 0 WHERE NOT EXISTS (&quot;</span> +</div>
<div class="line">        <span class="stringliteral">&quot;SELECT * FROM latest&quot;</span> +</div>
<div class="line">    <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line">);</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Helper Functions */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Convert Objects to string via operator&lt;&lt;</span></div>
<div class="line"><span class="keyword">template</span> &lt;<span class="keyword">typename</span> T&gt;</div>
<div class="line"><span class="keyword">inline</span> std::string sstos(<span class="keyword">const</span> T* input)</div>
<div class="line">{</div>
<div class="line">    std::stringstream ss;</div>
<div class="line">    ss &lt;&lt; (*input);</div>
<div class="line">    <span class="keywordflow">return</span> ss.str();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get Timestamp for Logs</span></div>
<div class="line"><span class="keyword">inline</span> std::string now()</div>
<div class="line">{</div>
<div class="line">    time_t ct = time(0);</div>
<div class="line">    <span class="keyword">struct </span>tm  tstruct;</div>
<div class="line">    <span class="keywordtype">char</span> buf[80];</div>
<div class="line">    tstruct = *localtime(&amp;ct);</div>
<div class="line">    strftime(buf, <span class="keyword">sizeof</span>(buf), <span class="stringliteral">&quot;%Y-%m-%d %X&quot;</span>, &amp;tstruct);</div>
<div class="line">    <span class="keywordflow">return</span> std::string(buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Log</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> log(<span class="keyword">const</span> std::string&amp; msg)</div>
<div class="line">{ std::cout &lt;&lt; now() &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; msg &lt;&lt; std::endl; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Log Error</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> error(<span class="keyword">const</span> std::string&amp; msg)</div>
<div class="line">{ std::cerr &lt;&lt; now() &lt;&lt; <span class="charliteral">&#39;\t&#39;</span> &lt;&lt; msg &lt;&lt; std::endl; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Error during the CLI step</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> CliError(<span class="keyword">const</span> <span class="keywordtype">char</span> *msg)</div>
<div class="line">{ perror(msg); exit(1); }</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Command Context */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyMarketHandler;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>Context {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Connection</div>
<div class="line">    {</div>
<div class="line">        sqlite3* sqlite_ptr = NULL; <span class="comment">// Connection to SQLite Database</span></div>
<div class="line">        <span class="keywordtype">int</span> sockfd = 0; <span class="comment">// File Descriptor for current Connection</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Market</div>
<div class="line">    {</div>
<div class="line">        <a name="_a0"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market_ptr = NULL; <span class="comment">// Pointer to Market Manager</span></div>
<div class="line">        MyMarketHandler* handler_ptr = NULL; <span class="comment">// Pointer to Market Handler</span></div>
<div class="line">        std::vector&lt;int&gt; changes = {}; <span class="comment">// List of changed orders</span></div>
<div class="line">        std::map&lt;int, std::string&gt; info = {}; <span class="comment">// Info</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span><a name="_a1"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a></div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">int</span> <span class="keywordtype">id</span> = 0; <span class="comment">// Order Id</span></div>
<div class="line">        std::string info = EMPTY_STR; <span class="comment">// Order Info</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>Command</div>
<div class="line">    {</div>
<div class="line">        std::string input = EMPTY_STR; <span class="comment">// Command Input</span></div>
<div class="line">        std::string response = EMPTY_STR; <span class="comment">// Command Response</span></div>
<div class="line">        <span class="keywordtype">int</span> response_size = MSG_SIZE_SMALL; <span class="comment">// Response Size</span></div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Context struct</span></div>
<div class="line">    <span class="keyword">struct </span>Ctx</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordtype">bool</span> enable = <span class="keyword">false</span>; <span class="comment">// Enable operation with context</span></div>
<div class="line">        Connection connection = Connection();</div>
<div class="line">        Market market = Market();</div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order = <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>();</div>
<div class="line">        Command command = Command();</div>
<div class="line">        </div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get Context</span></div>
<div class="line">    Ctx* Get()</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">static</span> Ctx ctx;</div>
<div class="line">        <span class="keywordflow">return</span> &amp;ctx;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Context</span></div>
<div class="line">    <span class="keyword">inline</span> <span class="keywordtype">void</span> Set(Ctx&amp; value)</div>
<div class="line">    {</div>
<div class="line">        Ctx* ctx = Get();</div>
<div class="line">        (*ctx) = value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear Context</span></div>
<div class="line">    <span class="keyword">inline</span> <span class="keywordtype">void</span> Clear()</div>
<div class="line">    {</div>
<div class="line">        Ctx ctx;</div>
<div class="line">        Set(ctx);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> chld_handler(<span class="keywordtype">int</span> signum)</div>
<div class="line">{</div>
<div class="line">    signal(SIGCHLD, chld_handler);</div>
<div class="line">    <span class="keywordtype">int</span> wstat;</div>
<div class="line">    wait3(&amp;wstat, WNOHANG, NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Change current process to Daemon</span></div>
<div class="line"><span class="keywordtype">void</span> Daemonize(<span class="keyword">const</span> <span class="keywordtype">char</span>* root)</div>
<div class="line">{</div>
<div class="line">    pid_t pid;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Fork off the parent process */</span></div>
<div class="line">    pid = fork();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* An error occurred */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pid &lt; 0)</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Success: Let the parent terminate */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pid &gt; 0)</div>
<div class="line">        exit(EXIT_SUCCESS);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* On success: The child process becomes session leader */</span></div>
<div class="line">    <span class="keywordflow">if</span> (setsid() &lt; 0)</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Catch, ignore and handle signals */</span></div>
<div class="line">    <span class="comment">//TODO: Implement a working signal handler */</span></div>
<div class="line">    signal(SIGCHLD, chld_handler);</div>
<div class="line">    signal(SIGHUP, SIG_IGN);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Fork off for the second time*/</span></div>
<div class="line">    pid = fork();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* An error occurred */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pid &lt; 0)</div>
<div class="line">        exit(EXIT_FAILURE);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Success: Let the parent terminate */</span></div>
<div class="line">    <span class="keywordflow">if</span> (pid &gt; 0)</div>
<div class="line">        exit(EXIT_SUCCESS);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Set new file permissions */</span></div>
<div class="line">    umask(0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Change the working directory to the root directory */</span></div>
<div class="line">    <span class="comment">/* or another appropriated directory */</span></div>
<div class="line">    <span class="keywordflow">if</span> (chdir(root) &lt; 0) { error(<span class="stringliteral">&quot;error changing root directory&quot;</span>); exit(1); };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Close all open file descriptors</span></div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> fd = sysconf(_SC_OPEN_MAX); fd &gt;= 0; fd--)</div>
<div class="line">    { close(fd); }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Create Unix socket</span></div>
<div class="line"><span class="keywordtype">int</span> UnixSocket(<span class="keyword">const</span> <span class="keywordtype">char</span>* path, <span class="keywordtype">int</span> clients)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Set Variables</span></div>
<div class="line">    <span class="keyword">struct </span>sockaddr_un sock_addr;</div>
<div class="line">    <span class="keywordtype">int</span> sockfd, addr_len;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Address</span></div>
<div class="line">    bzero((<span class="keywordtype">char</span> *) &amp;sock_addr, <span class="keyword">sizeof</span>(sock_addr));</div>
<div class="line">    sock_addr.sun_family = AF_UNIX;</div>
<div class="line">    strcpy(sock_addr.sun_path, path);</div>
<div class="line">    addr_len = strlen(sock_addr.sun_path) + <span class="keyword">sizeof</span>(sock_addr.sun_family);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create socket</span></div>
<div class="line">    <span class="keywordflow">if</span> ((sockfd = socket(AF_UNIX, SOCK_STREAM, 0)) &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Bind socket</span></div>
<div class="line">    <span class="keywordflow">if</span> (bind(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;sock_addr, addr_len) &lt; 0) <span class="keywordflow">return</span> -2;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Listen for connection</span></div>
<div class="line">    <span class="keywordflow">if</span> (listen(sockfd, clients) &lt; 0) <span class="keywordflow">return</span> -3;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Return file descriptor</span></div>
<div class="line">    <span class="keywordflow">return</span> sockfd;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Connect to Unix socket</span></div>
<div class="line"><span class="keywordtype">int</span> ConnectUnixSocket(<span class="keyword">const</span> <span class="keywordtype">char</span>* path)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Set Variables</span></div>
<div class="line">    <span class="keyword">struct </span>sockaddr_un sock_addr;</div>
<div class="line">    <span class="keywordtype">int</span> sockfd, addr_len;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Address</span></div>
<div class="line">    bzero((<span class="keywordtype">char</span> *) &amp;sock_addr, <span class="keyword">sizeof</span>(sock_addr));</div>
<div class="line">    sock_addr.sun_family = AF_UNIX;</div>
<div class="line">    strcpy(sock_addr.sun_path, path);</div>
<div class="line">    addr_len = strlen(sock_addr.sun_path) + <span class="keyword">sizeof</span>(sock_addr.sun_family);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create socket</span></div>
<div class="line">    <span class="keywordflow">if</span> ((sockfd = socket(AF_UNIX, SOCK_STREAM, 0)) &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connect socket</span></div>
<div class="line">    <span class="keywordflow">if</span> (connect(sockfd, (<span class="keyword">struct</span> sockaddr *) &amp;sock_addr, addr_len) &lt; 0) <span class="keywordflow">return</span> -2;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> sockfd;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if descriptor is ready for read (non-blocking)</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> SelectReadNonBlocking(<span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">    fd_set fdset; <span class="comment">// Single descriptor set</span></div>
<div class="line">    FD_ZERO(&amp;fdset); FD_SET(fd, &amp;fdset);</div>
<div class="line">    <span class="keyword">struct </span>timeval tv = {0, 0}; <span class="comment">// Timeout zero (to prevent blocking)</span></div>
<div class="line">    <span class="keywordflow">return</span> select(fd + 1, &amp;fdset, NULL, NULL, &amp;tv);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Check if descriptor is ready for write</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> SelectWrite(<span class="keywordtype">int</span> fd)</div>
<div class="line">{</div>
<div class="line">    fd_set fdset; <span class="comment">// Single descriptor set</span></div>
<div class="line">    FD_ZERO(&amp;fdset); FD_SET(fd, &amp;fdset);</div>
<div class="line">    <span class="keyword">struct </span>timeval tv = {1, 0}; <span class="comment">// Timeout of 1 second</span></div>
<div class="line">    <span class="keywordflow">return</span> select(fd + 1, NULL, &amp;fdset, NULL, &amp;tv);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Apply select() on vector of file descriptors</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> SelectVector(std::vector&lt;int&gt;* fdvec)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> maxfd = 0; <span class="comment">// Max descriptor number</span></div>
<div class="line">    fd_set fdset; <span class="comment">// Descriptor set</span></div>
<div class="line">    FD_ZERO(&amp;fdset);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> fd : *fdvec)</div>
<div class="line">    {</div>
<div class="line">        FD_SET(fd, &amp;fdset); <span class="comment">// Add descriptor to set</span></div>
<div class="line">        <span class="keywordflow">if</span> (fd &gt; maxfd) maxfd = fd;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (maxfd == 0) <span class="keywordflow">return</span> 0; <span class="comment">// Vector empty</span></div>
<div class="line">    <span class="keywordflow">return</span> select(maxfd + 1, &amp;fdset, NULL, NULL, NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Apply close() on vector of file descriptors</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> CloseVector(std::vector&lt;int&gt;* fdvec)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> code = 0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> it = (*fdvec).rbegin(); it != (*fdvec).rend(); ++it)</div>
<div class="line">        { code += close(*it); } <span class="comment">// Do reverse iteration on the vector</span></div>
<div class="line">    <span class="keywordflow">if</span> (code &lt; 0) <span class="keywordflow">return</span> -1;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0; <span class="comment">// Return close() code</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Read stream on Unix socket (non-blocking)</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> ReadSocketStream(<span class="keywordtype">int</span> sockfd, <span class="keywordtype">int</span> size, std::string* dest)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Always clear string</span></div>
<div class="line">    (*dest).clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if data is available</span></div>
<div class="line">    <span class="keywordtype">int</span> rdy = SelectReadNonBlocking(sockfd);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy &lt;= 0) <span class="keywordflow">return</span> rdy;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read stream to string</span></div>
<div class="line">    <span class="keywordtype">char</span> buffer[MSG_SIZE_LARGE];</div>
<div class="line">    <span class="keywordflow">if</span> (read(sockfd, buffer, size) &lt;= 0) <span class="keywordflow">return</span> -1;</div>
<div class="line">    (*dest).append(buffer, strcspn(buffer, <span class="stringliteral">&quot;\0&quot;</span>)); <span class="comment">// buffer is copied to string until the first \0 char is found</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Write to stream on Unix socket</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> WriteSocketStream(<span class="keywordtype">int</span> sockfd, <span class="keywordtype">int</span> size, std::string* data)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Check if write is available</span></div>
<div class="line">    <span class="keywordtype">int</span> rdy = SelectWrite(sockfd);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy &lt;= 0) <span class="keywordflow">return</span> rdy;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write string to stream</span></div>
<div class="line">    <span class="keywordtype">char</span> buffer[MSG_SIZE_LARGE];</div>
<div class="line">    strcpy(buffer, (*data).c_str() + <span class="charliteral">&#39;\0&#39;</span>); <span class="comment">// string is copied to buffer with a trailing \0 char </span></div>
<div class="line">    <span class="keywordflow">if</span> (write(sockfd, buffer, size) &lt;= 0) <span class="keywordflow">return</span> -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Accept connection on Unix socket (non-blocking)</span></div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">int</span> AcceptConnection(<span class="keywordtype">int</span> sockfd)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Check if connection is available</span></div>
<div class="line">    <span class="keywordtype">int</span> rdy = SelectReadNonBlocking(sockfd);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy &lt;= 0) <span class="keywordflow">return</span> rdy;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">struct </span>sockaddr_un sock_addr;</div>
<div class="line">    socklen_t sock_len = <span class="keyword">sizeof</span>(sock_addr);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Accept connection</span></div>
<div class="line">    <span class="keywordflow">return</span> accept(sockfd, (<span class="keyword">struct</span> sockaddr *)&amp;sock_addr, &amp;sock_len);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parse Order to CSV</span></div>
<div class="line"><span class="keyword">inline</span> std::string ParseOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">    std::string info;</div>
<div class="line">    std::map&lt;int, std::string&gt; info_map = (*ctx).market.info;</div>
<div class="line">    <span class="keywordflow">if</span> (info_map.find((<span class="keywordtype">int</span>)order.<a name="a2"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) != info_map.end()) info = info_map[(int)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>];</div>
<div class="line">    info = std::regex_replace(info, std::regex(<span class="stringliteral">&quot;\&quot;&quot;</span>), <span class="stringliteral">&quot;\\\&quot;&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        std::to_string(order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) + CSV_SEP +</div>
<div class="line">        std::to_string(order.<a name="a3"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ad78901a32671682eb2e829e73e5a6839">SymbolId</a>) + CSV_SEP +</div>
<div class="line">        ORDER_TYPES[(int)order.<a name="a4"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8f9a2bd4403993d06556167258a3ed95">Type</a>] + CSV_SEP +</div>
<div class="line">        ORDER_SIDES[(<span class="keywordtype">int</span>)order.<a name="a5"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a326726dbed270af12b64bc1eefd42673">Side</a>] + CSV_SEP +</div>
<div class="line">        std::to_string(order.<a name="a6"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a38c3dbc9e2e9ca4d91827a7f3a195dc7">Price</a>) + CSV_SEP +</div>
<div class="line">        std::to_string(order.<a name="a7"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8780a90b1a61f2866eb78182e306db12">StopPrice</a>) + CSV_SEP +</div>
<div class="line">        std::to_string(order.<a name="a8"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#aeb6dd457fd9f343d0f9da913cc1f199c">Quantity</a>) + CSV_SEP +</div>
<div class="line">        ORDER_TIFS[(int)order.<a name="a9"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a9f0f38e28183909ed38c970ad9c8f96c">TimeInForce</a>] + CSV_SEP +</div>
<div class="line">        ((order.<a name="a10"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a020f762b9b3d40816d3ac083edb5fbec">IsHidden</a>() || order.<a name="a11"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a0cd1433ebde9773d0c084dc094fc2b51">IsIceberg</a>())</div>
<div class="line">            ? std::to_string(order.<a name="a12"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a3d51591547fdb6db893771bf0f00d118">MaxVisibleQuantity</a>)</div>
<div class="line">            : NULL_STR</div>
<div class="line">        ) + CSV_SEP +</div>
<div class="line">        ((order.IsSlippage())</div>
<div class="line">            ? std::to_string(order.Slippage)</div>
<div class="line">            : NULL_STR</div>
<div class="line">        ) + CSV_SEP +</div>
<div class="line">        ((order.IsTrailingStop() || order.IsTrailingStopLimit())</div>
<div class="line">            ? std::to_string(order.TrailingDistance) + CSV_SEP +</div>
<div class="line">                std::to_string(order.TrailingStep)</div>
<div class="line">            : NULL_STR + CSV_SEP + NULL_STR</div>
<div class="line">        ) + CSV_SEP +</div>
<div class="line">        std::to_string(order.ExecutedQuantity) + CSV_SEP +</div>
<div class="line">        std::to_string(order.LeavesQuantity) + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;\&quot;&quot;</span> + info + <span class="stringliteral">&quot;\&quot;&quot;</span></div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parse OrderBook::Levels to CSV</span></div>
<div class="line">std::string ParseOrderBookLevels(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html#ae6b230468dfe944117862f8d80a45f41">OrderBook::Levels</a> levels, <span class="keyword">const</span> <span class="keywordtype">char</span>* group)</div>
<div class="line">{</div>
<div class="line">    std::string csv;</div>
<div class="line">    std::string level_props;</div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Loop over Levels orders</span></div>
<div class="line">    <span class="keywordflow">for</span> (<a name="_a13"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_level_node.html">LevelNode</a> level : levels)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Get Level properties</span></div>
<div class="line">        level_props = (</div>
<div class="line">            group + CSV_SEP +</div>
<div class="line">            LEVEL_TYPES[(int)level.Type] + CSV_SEP +</div>
<div class="line">            std::to_string(level.Price)</div>
<div class="line">        );</div>
<div class="line">        <span class="keywordflow">for</span> (<a name="_a14"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order_node.html">OrderNode</a> node : level.OrderList)</div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>* order = (*market).GetOrder(node.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>);</div>
<div class="line">            csv.append(</div>
<div class="line">                level_props + CSV_SEP + <span class="comment">// Insert level properties</span></div>
<div class="line">                ParseOrder(*order) + CSV_EOL <span class="comment">// Insert Order properties</span></div>
<div class="line">            );</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> csv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Parse OrderBook to CSV</span></div>
<div class="line">std::string ParseOrderBook(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> <a name="_a15"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>* order_book_ptr)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Insert header</span></div>
<div class="line">    std::string csv;</div>
<div class="line">    csv.append(</div>
<div class="line">        CSV_HEADER_FOR_BOOK + CSV_SEP +</div>
<div class="line">        CSV_HEADER_FOR_ORDER + CSV_SEP +</div>
<div class="line">        <span class="stringliteral">&quot;Info&quot;</span> + CSV_EOL</div>
<div class="line">    );</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Parse Levels</span></div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).bids(), <span class="stringliteral">&quot;BIDS&quot;</span>));</div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).asks(), <span class="stringliteral">&quot;ASKS&quot;</span>));</div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).buy_stop(), <span class="stringliteral">&quot;BUY_STOP&quot;</span>));</div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).sell_stop(), <span class="stringliteral">&quot;SELL_STOP&quot;</span>));</div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).trailing_buy_stop(), <span class="stringliteral">&quot;TRAILING_BUY_STOP&quot;</span>));</div>
<div class="line">    csv.append(ParseOrderBookLevels(market, (*order_book_ptr).trailing_sell_stop(), <span class="stringliteral">&quot;TRAILING_SELL_STOP&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> csv;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate Query to insert Order into SQLite</span></div>
<div class="line"><span class="keyword">inline</span> std::string InsertQueryFromOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order, std::string info)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (</div>
<div class="line">        <span class="stringliteral">&quot;INSERT INTO orders (&quot;</span> + CSV_HEADER_FOR_ORDER + <span class="stringliteral">&quot;,Info) VALUES (&quot;</span> +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)SYMBOL_ID) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8f9a2bd4403993d06556167258a3ed95">Type</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a326726dbed270af12b64bc1eefd42673">Side</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a38c3dbc9e2e9ca4d91827a7f3a195dc7">Price</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8780a90b1a61f2866eb78182e306db12">StopPrice</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#aeb6dd457fd9f343d0f9da913cc1f199c">Quantity</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a9f0f38e28183909ed38c970ad9c8f96c">TimeInForce</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a3d51591547fdb6db893771bf0f00d118">MaxVisibleQuantity</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a name="a16"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ae3c50002ba4f8486d6e288e4cee9d0fa">Slippage</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a name="a17"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#aacaa8f37a245bb45e4fc1e1372517920">TrailingDistance</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a name="a18"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a50407e3856a81f25cc2da01599f15f02">TrailingStep</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a name="a19"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a555135d11f7188cb08d51be8455ada85">ExecutedQuantity</a>) + CSV_SEP +</div>
<div class="line">            std::to_string((<span class="keywordtype">int</span>)order.<a name="a20"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a798b7777f5c575a301c6174af2c23e94">LeavesQuantity</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;&#39;&quot;</span> + info + <span class="stringliteral">&quot;&#39;&quot;</span> +</div>
<div class="line">        <span class="stringliteral">&quot;)&quot;</span></div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate Query to update Order into SQLite</span></div>
<div class="line"><span class="keyword">inline</span> std::string UpdateQueryFromOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (EMPTY_STR +</div>
<div class="line">        <span class="stringliteral">&quot;UPDATE orders SET &quot;</span> +</div>
<div class="line">            <span class="stringliteral">&quot;Type=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8f9a2bd4403993d06556167258a3ed95">Type</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;Side=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a326726dbed270af12b64bc1eefd42673">Side</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;Price=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a38c3dbc9e2e9ca4d91827a7f3a195dc7">Price</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;StopPrice=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a8780a90b1a61f2866eb78182e306db12">StopPrice</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;Quantity=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#aeb6dd457fd9f343d0f9da913cc1f199c">Quantity</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;TimeInForce=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a9f0f38e28183909ed38c970ad9c8f96c">TimeInForce</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;MaxVisibleQuantity=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a3d51591547fdb6db893771bf0f00d118">MaxVisibleQuantity</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;Slippage=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ae3c50002ba4f8486d6e288e4cee9d0fa">Slippage</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;TrailingDistance=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#aacaa8f37a245bb45e4fc1e1372517920">TrailingDistance</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;TrailingStep=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a50407e3856a81f25cc2da01599f15f02">TrailingStep</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;ExecutedQuantity=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a555135d11f7188cb08d51be8455ada85">ExecutedQuantity</a>) + CSV_SEP +</div>
<div class="line">            <span class="stringliteral">&quot;LeavesQuantity=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a798b7777f5c575a301c6174af2c23e94">LeavesQuantity</a>) +</div>
<div class="line">        <span class="stringliteral">&quot; WHERE &quot;</span> +</div>
<div class="line">            <span class="stringliteral">&quot;Id=&quot;</span> + std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>)</div>
<div class="line">    );</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Generate new Order from result of Query</span></div>
<div class="line"><span class="keyword">inline</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> OrderFromQuery(sqlite3_stmt* row)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order = <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>(</div>
<div class="line">        sqlite3_column_int(row, 0), <span class="comment">// Id</span></div>
<div class="line">        SYMBOL_ID, <span class="comment">// Symbol</span></div>
<div class="line">        <a name="a21"></a><a class="code" href="namespace_cpp_trader_1_1_matching.html#a3f665b3bd035eb7a647258ce0ca1dd43">OrderType</a>(sqlite3_column_int(row, 2)), <span class="comment">// Type</span></div>
<div class="line">        <a name="a22"></a><a class="code" href="namespace_cpp_trader_1_1_matching.html#a07e8bfcb84f50475ba6ca9d29a6ca668">OrderSide</a>(sqlite3_column_int(row, 3)), <span class="comment">// Side</span></div>
<div class="line">        sqlite3_column_int(row, 4), <span class="comment">// Price</span></div>
<div class="line">        sqlite3_column_int(row, 5), <span class="comment">// Stop Price</span></div>
<div class="line">        sqlite3_column_int(row, 6), <span class="comment">// Quantity</span></div>
<div class="line">        <a name="a23"></a><a class="code" href="namespace_cpp_trader_1_1_matching.html#a3c4a6bd3748dd98d9daff8e5c40b2b9a">OrderTimeInForce</a>(sqlite3_column_int(row, 7)), <span class="comment">// Time In Force</span></div>
<div class="line">        sqlite3_column_int(row, 8), <span class="comment">// Max Visible Quantity</span></div>
<div class="line">        sqlite3_column_int(row, 9), <span class="comment">// Slippage</span></div>
<div class="line">        sqlite3_column_int(row, 10), <span class="comment">// Trailing Distance</span></div>
<div class="line">        sqlite3_column_int(row, 11) <span class="comment">// Trailing Step</span></div>
<div class="line">    );</div>
<div class="line">    order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a555135d11f7188cb08d51be8455ada85">ExecutedQuantity</a> = sqlite3_column_int(row, 12); <span class="comment">// Executed Quantity</span></div>
<div class="line">    order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#a798b7777f5c575a301c6174af2c23e94">LeavesQuantity</a> = sqlite3_column_int(row, 13); <span class="comment">// Leaves Quantity</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> order;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Populate SQLite Database</span></div>
<div class="line"><span class="keywordtype">void</span> PopulateDatabase(sqlite3* db)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Create Tables in SQLite</span></div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> std::string query = (</div>
<div class="line">        QUERY_CREATE_TABLE_LATEST + <span class="stringliteral">&quot;; &quot;</span> +</div>
<div class="line">        QUERY_INSERT_INTO_LATEST + <span class="stringliteral">&quot;; &quot;</span> +</div>
<div class="line">        QUERY_CREATE_TABLE_ORDERS + <span class="stringliteral">&quot;;&quot;</span></div>
<div class="line">    );</div>
<div class="line">    <span class="keywordtype">char</span>* err;</div>
<div class="line">    <span class="keywordtype">int</span> rdy = sqlite3_exec(db, query.c_str(), NULL, NULL, &amp;err);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">    { error(<span class="stringliteral">&quot;sqlite error(1): &quot;</span> + sstos(&amp;err)); exit(1); };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get Latest Id from Database</span></div>
<div class="line"><span class="keywordtype">int</span> GetLatestId(sqlite3* db) </div>
<div class="line">{</div>
<div class="line">    sqlite3_stmt* result;</div>
<div class="line">    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* query = <span class="stringliteral">&quot;SELECT * FROM latest&quot;</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Prepare query</span></div>
<div class="line">    <span class="keywordtype">int</span> rdy = sqlite3_prepare(db, query, -1, &amp;result, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* err = sqlite3_errmsg(db);</div>
<div class="line">        error(<span class="stringliteral">&quot;sqlite error(2): &quot;</span> + sstos(&amp;err));</div>
<div class="line">        exit(1);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get Latest value</span></div>
<div class="line">    <span class="keywordtype">int</span> lts = 0;</div>
<div class="line">    <span class="keywordflow">while</span> (sqlite3_step(result) == SQLITE_ROW)</div>
<div class="line">    { lts = sqlite3_column_int(result, 0); };</div>
<div class="line">    <span class="keywordflow">return</span> lts;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Populate Local Order Book from SQLite</span></div>
<div class="line"><span class="keywordtype">void</span> PopulateBook(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, sqlite3* db, <span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Add Symbol</span></div>
<div class="line">    <a name="_a24"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_symbol.html">Symbol</a> symbol(SYMBOL_ID, name);</div>
<div class="line">    <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> err = (*market).AddSymbol(symbol);</div>
<div class="line">    <span class="keywordflow">if</span> (err != ErrorCode::OK)</div>
<div class="line">    { error(<span class="stringliteral">&quot;Failed AddSymbol: &quot;</span> + sstos(&amp;err)); exit(1); };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Add Book</span></div>
<div class="line">    err = (*market).AddOrderBook(symbol);</div>
<div class="line">    <span class="keywordflow">if</span> (err != ErrorCode::OK)</div>
<div class="line">    { error(<span class="stringliteral">&quot;Failed AddOrderBook: &quot;</span> + sstos(&amp;err)); exit(1); };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Prepare query</span></div>
<div class="line">    sqlite3_stmt* result;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* query = <span class="stringliteral">&quot;SELECT * FROM orders&quot;</span>;</div>
<div class="line">    <span class="keywordtype">int</span> rdy = sqlite3_prepare(db, query, -1, &amp;result, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* _err = sqlite3_errmsg(db);</div>
<div class="line">        error(<span class="stringliteral">&quot;sqlite error(3): &quot;</span> + sstos(&amp;_err));</div>
<div class="line">        exit(1);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Get Orders</span></div>
<div class="line">    <span class="keywordflow">while</span> (sqlite3_step(result) == SQLITE_ROW)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Add Order</span></div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order = OrderFromQuery(result);</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* info = sqlite3_column_text(result, 14);</div>
<div class="line">        (*ctx).order.info = std::string((<span class="keywordtype">char</span> <span class="keyword">const</span>*)info);</div>
<div class="line">        (*ctx).order.id = (int)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>;</div>
<div class="line">        err = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (err != ErrorCode::OK)</div>
<div class="line">        { error(<span class="stringliteral">&quot;Failed AddOrder: &quot;</span> + sstos(&amp;err)); exit(1); };</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">    (*ctx).order = Context::Order();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Custom Market Handler */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>MyMarketHandler : <span class="keyword">public</span> <a name="_a25"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_market_handler.html">MarketHandler</a></div>
<div class="line">{</div>
<div class="line"> </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">    <span class="keywordtype">size_t</span> _updates;</div>
<div class="line">    <span class="keywordtype">size_t</span> _symbols;</div>
<div class="line">    <span class="keywordtype">size_t</span> _max_symbols;</div>
<div class="line">    <span class="keywordtype">size_t</span> _order_books;</div>
<div class="line">    <span class="keywordtype">size_t</span> _max_order_books;</div>
<div class="line">    <span class="keywordtype">size_t</span> _max_order_book_levels;</div>
<div class="line">    <span class="keywordtype">size_t</span> _max_order_book_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _max_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _add_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _update_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _delete_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _execute_orders;</div>
<div class="line">    <span class="keywordtype">size_t</span> _lts_order_id;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    MyMarketHandler(<span class="keywordtype">int</span> lts)</div>
<div class="line">        : _updates(0),</div>
<div class="line">          _symbols(0),</div>
<div class="line">          _max_symbols(0),</div>
<div class="line">          _order_books(0),</div>
<div class="line">          _max_order_books(0),</div>
<div class="line">          _max_order_book_levels(0),</div>
<div class="line">          _max_order_book_orders(0),</div>
<div class="line">          _orders(0),</div>
<div class="line">          _max_orders(0),</div>
<div class="line">          _add_orders(0),</div>
<div class="line">          _update_orders(0),</div>
<div class="line">          _delete_orders(0),</div>
<div class="line">          _execute_orders(0),</div>
<div class="line">          _lts_order_id(lts)</div>
<div class="line">    {}</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span> updates()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _updates; }</div>
<div class="line">    <span class="keywordtype">size_t</span> max_symbols()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _max_symbols; }</div>
<div class="line">    <span class="keywordtype">size_t</span> max_order_books()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _max_order_books; }</div>
<div class="line">    <span class="keywordtype">size_t</span> max_order_book_levels()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _max_order_book_levels; }</div>
<div class="line">    <span class="keywordtype">size_t</span> max_order_book_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _max_order_book_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> max_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _max_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> add_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _add_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> update_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _update_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> delete_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _delete_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> execute_orders()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _execute_orders; }</div>
<div class="line">    <span class="keywordtype">size_t</span> lts_order_id()<span class="keyword"> const </span>{ <span class="keywordflow">return</span> _lts_order_id; }</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Handler Callbacks */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">    <span class="keywordtype">void</span> onAddSymbol(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_symbol.html">Symbol</a>&amp; symbol)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; ++_symbols; _max_symbols = std::max(_symbols, _max_symbols);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Add Symbol</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Add symbol: &quot;</span> + sstos(&amp;symbol));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server AddSymbol 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onDeleteSymbol(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_symbol.html">Symbol</a>&amp; symbol)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; --_symbols;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Delete Symbol</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Delete symbol: &quot;</span> + sstos(&amp;symbol)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server DeleteSymbol 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onAddOrderBook(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; ++_order_books; _max_order_books = std::max(_order_books, _max_order_books);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Add Order Book</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Add order book: &quot;</span> + sstos(&amp;order_book)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server AddOrderBook 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onUpdateOrderBook(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book, <span class="keywordtype">bool</span> top)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        _max_order_book_levels = std::max(std::max(order_book.<a name="a26"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html#a613c21ef0c5097641a559032b0d1df3d">bids</a>().size(), order_book.<a name="a27"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html#a5dc10173d986f48d519c5da0e4d8d29b">asks</a>().size()), _max_order_book_levels);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Update Order Book</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Update order book: &quot;</span> + sstos(&amp;order_book) + (top ? <span class="stringliteral">&quot; - Top of the book!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server UpdateOrderBook 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onDeleteOrderBook(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; --_order_books;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Delete Order Book</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Delete order book: &quot;</span> + sstos(&amp;order_book)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server DeleteOrderBook 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onAddLevel(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book, <span class="keyword">const</span> <a name="_a28"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_level.html">Level</a>&amp; level, <span class="keywordtype">bool</span> top)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Add Level</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Add level: &quot;</span> + sstos(&amp;level) + (top ? <span class="stringliteral">&quot; - Top of the book!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server AddLevel 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onUpdateLevel(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book, <span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_level.html">Level</a>&amp; level, <span class="keywordtype">bool</span> top)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; _max_order_book_orders = std::max(level.<a name="a29"></a><a class="code" href="struct_cpp_trader_1_1_matching_1_1_level.html#a164155ae2b8f0c691be8292c5e39084b">Orders</a>, _max_order_book_orders);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Update Level</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Update level: &quot;</span> + sstos(&amp;level) + (top ? <span class="stringliteral">&quot; - Top of the book!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server UpdateLevel 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onDeleteLevel(<span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>&amp; order_book, <span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_level.html">Level</a>&amp; level, <span class="keywordtype">bool</span> top)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Delete Leve</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Delete level: &quot;</span> + sstos(&amp;level) + (top ? <span class="stringliteral">&quot; - Top of the book!&quot;</span> : <span class="stringliteral">&quot;&quot;</span>)); </div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/scripts/server DeleteLevel 123&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + strerror(errno)); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onAddOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; ++_orders; _max_orders = std::max(_orders, _max_orders); ++_add_orders;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Update Unique Id Record</span></div>
<div class="line">        _lts_order_id = std::max((<span class="keywordtype">size_t</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>, _lts_order_id);</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if Id is Sync</span></div>
<div class="line">        <span class="keywordflow">if</span> ((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a> != (*ctx).order.id)</div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Error at &#39;onAddOrder&#39; callback: id out of sync&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Store Order Info</span></div>
<div class="line">        (*ctx).market.info.insert(</div>
<div class="line">            std::make_pair((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>, (*ctx).order.info)</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        std::string <span class="keywordtype">id</span> = std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>);</div>
<div class="line"> </div>
<div class="line">        sqlite3* db = (*ctx).connection.sqlite_ptr;</div>
<div class="line">        <span class="keywordtype">char</span>* err;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add order to SQLite</span></div>
<div class="line">        <span class="keyword">const</span> std::string query = (EMPTY_STR +</div>
<div class="line">            <span class="stringliteral">&quot;BEGIN; &quot;</span> +</div>
<div class="line">            <span class="stringliteral">&quot;UPDATE latest SET Id=&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;; &quot;</span> +</div>
<div class="line">            InsertQueryFromOrder(order, (*ctx).order.info) + <span class="stringliteral">&quot;; &quot;</span> +</div>
<div class="line">            <span class="stringliteral">&quot;COMMIT;&quot;</span></div>
<div class="line">        );</div>
<div class="line">        <span class="keywordtype">int</span> rdy = sqlite3_exec(db, query.c_str(), NULL, NULL, &amp;err);</div>
<div class="line">        <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">        { error(<span class="stringliteral">&quot;sqlite error(4): &quot;</span> + sstos(&amp;err)); };</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Add Order</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Add order: &quot;</span> + sstos(&amp;order));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // Send to server with system()</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/BTC_TUSD/server AddOrder &quot; + id + &quot;:&quot; + (*ctx).order.info;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0) { error(&quot;Error doing system call &quot; + std::string(strerror(errno))); }</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Set response to client</span></div>
<div class="line">        (*ctx).command.response = id;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Update orders when half filled */</span></div>
<div class="line">    <span class="keywordtype">void</span> onUpdateOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; ++_update_orders;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// First get info/transaction ID variable</span></div>
<div class="line">        std::string info;</div>
<div class="line">        std::map&lt;int, std::string&gt; info_map = (*ctx).market.info;</div>
<div class="line">        <span class="keywordflow">if</span> (info_map.find((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) != info_map.end()) info = info_map[(int)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        if (!(*ctx).enable) return;</div>
<div class="line"> </div>
<div class="line">        sqlite3* db = (*ctx).connection.sqlite_ptr;</div>
<div class="line">        <span class="keywordtype">char</span>* err;</div>
<div class="line"> </div>
<div class="line">        const std::<span class="keywordtype">string</span> query = UpdateQueryFromOrder(order);</div>
<div class="line">        <span class="keywordtype">int</span> rdy = sqlite3_exec(db, query.c_str(), NULL, NULL, &amp;err);</div>
<div class="line">        if (rdy != SQLITE_OK)</div>
<div class="line">        { error(<span class="stringliteral">&quot;sqlite error(6): &quot;</span> + sstos(&amp;err)); };</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// *** Send to server with system()</span></div>
<div class="line">        <span class="comment">// NOT NEEDED BECAUSE I CAN CALCULATE PARTIAL TRADES</span></div>
<div class="line">        <span class="comment">// BUT CAN BE USED IN FUTURE TO CROSS CHECK THESE PARTIAL CALCS</span></div>
<div class="line">        <span class="comment">//std::string cmd = &quot;/home/sysop/books/BTC_TUSD/execute_processor UpdateOrder &#39;&quot; + sstos(&amp;order) + &quot;:&quot; + info + &quot;&#39; &gt; execute_processor.txt 2&gt;&amp;1 &amp;&quot;;</span></div>
<div class="line">        <span class="comment">//int iCallResult = system(cmd.c_str());</span></div>
<div class="line">        <span class="comment">//if (iCallResult &lt; 0 &amp;&amp; iCallResult != -1) { error(&quot;Error doing system call (AC862): &quot; + std::string(strerror(errno)) + &quot; &quot; + std::to_string(iCallResult)); }</span></div>
<div class="line">        <span class="comment">// *** Send to server end</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onDeleteOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; --_orders; ++_delete_orders;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// First get info/transaction ID variable</span></div>
<div class="line">        std::string info;</div>
<div class="line">        std::map&lt;int, std::string&gt; info_map = (*ctx).market.info;</div>
<div class="line">        <span class="keywordflow">if</span> (info_map.find((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) != info_map.end()) info = info_map[(int)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Delete Order Info</span></div>
<div class="line">        (*ctx).market.info.erase(</div>
<div class="line">            (*ctx).market.info.find((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>)</div>
<div class="line">        );</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        std::string <span class="keywordtype">id</span> = std::to_string((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>);</div>
<div class="line"> </div>
<div class="line">        sqlite3* db = (*ctx).connection.sqlite_ptr;</div>
<div class="line">        <span class="keywordtype">char</span>* err;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Delete order from SQLite</span></div>
<div class="line">        <span class="keyword">const</span> std::string query = (</div>
<div class="line">            <span class="stringliteral">&quot;DELETE FROM orders WHERE Id=&quot;</span> + id</div>
<div class="line">        );</div>
<div class="line">        <span class="keywordtype">int</span> rdy = sqlite3_exec(db, query.c_str(), NULL, NULL, &amp;err);</div>
<div class="line">        <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">        { error(<span class="stringliteral">&quot;sqlite error(5): &quot;</span> + sstos(&amp;err)); };</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Deleted Order</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Delete order: &quot;</span> + sstos(&amp;order) + <span class="stringliteral">&quot; and info &quot;</span> + info);</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // *** Send to server</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/BTC_TUSD/execute_processor DeleteOrder &#39;&quot; + id + &quot;:&quot; + sstos(&amp;order) + &quot;:&quot; + info + &quot;&#39; &gt; execute_processor.txt 2&gt;&amp;1 &amp;&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0 &amp;&amp; iCallResult != -1) { error(&quot;Error doing system call (BB332): &quot; + std::string(strerror(errno)) + &quot; &quot; + std::to_string(iCallResult)); }</span></div>
<div class="line"><span class="comment">        // *** Send to server end</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line"> </div>
<div class="line">        std::string command = (*ctx).command.input;</div>
<div class="line">        <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;delete order&quot;</span>) == std::string::npos) <span class="keywordflow">return</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">// Set response to client</span></div>
<div class="line">        (*ctx).command.response = <span class="stringliteral">&quot;OK&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">void</span> onExecuteOrder(<span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>&amp; order, uint64_t price, uint64_t quantity)<span class="keyword"> override</span></div>
<div class="line"><span class="keyword">    </span>{</div>
<div class="line">        ++_updates; ++_execute_orders;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Add Order Id to changes if not already added</span></div>
<div class="line">        std::vector&lt;int&gt; ch = (*ctx).market.changes;</div>
<div class="line">        std::vector&lt;int&gt;::iterator it = find(ch.begin(), ch.end(), (<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>);</div>
<div class="line">        <span class="keywordflow">if</span> (it == ch.end()) (*ctx).market.changes.push_back((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Check if operation is enabled</span></div>
<div class="line">        <span class="keywordflow">if</span> (!(*ctx).enable) <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Get info/transaction ID variable</span></div>
<div class="line">        std::string info;</div>
<div class="line">        std::map&lt;int, std::string&gt; info_map = (*ctx).market.info;</div>
<div class="line">        <span class="keywordflow">if</span> (info_map.find((<span class="keywordtype">int</span>)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>) != info_map.end()) info = info_map[(int)order.<a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">Id</a>];</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Log Executed Order</span></div>
<div class="line">        log(<span class="stringliteral">&quot;Execute order: &quot;</span> + sstos(&amp;order) + <span class="stringliteral">&quot; with price &quot;</span> + sstos(&amp;price) + <span class="stringliteral">&quot; and quantity &quot;</span> + sstos(&amp;quantity) + <span class="stringliteral">&quot; and info &quot;</span> + info);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        std::string csv;</span></div>
<div class="line"><span class="comment">        csv.append(OrderCSVHeader + CSV_SEP + &quot;Price&quot; + CSV_SEP + &quot;Quantity&quot; + CSV_EOL);</span></div>
<div class="line"><span class="comment">        csv.append(ParseOrder(order) + CSV_SEP + std::to_string(price) + CSV_SEP + std::to_string(quantity) + CSV_EOL);</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">        </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        // *** Send to server with system()</span></div>
<div class="line"><span class="comment">        std::string cmd = &quot;/home/sysop/books/BTC_TUSD/execute_processor ExecuteOrder &#39;&quot; + sstos(&amp;price) + &quot;@&quot; + sstos(&amp;quantity) + &quot;:&quot; + sstos(&amp;order) + &quot;:&quot; + info + &quot;&#39; &gt; execute_processor.txt 2&gt;&amp;1 &amp;&quot;;</span></div>
<div class="line"><span class="comment">        int iCallResult = system(cmd.c_str());</span></div>
<div class="line"><span class="comment">        if (iCallResult &lt; 0 &amp;&amp; iCallResult != -1) { error(&quot;Error doing system call (AA832): &quot; + std::string(strerror(errno)) + &quot; &quot; + std::to_string(iCallResult)); }</span></div>
<div class="line"><span class="comment">        // *** Send to server end</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Symbols */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddSymbol(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add symbol (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">char</span> name[8];</div>
<div class="line">        std::string sname = match[2];</div>
<div class="line">        std::memcpy(name, sname.data(), std::min(sname.size(), <span class="keyword">sizeof</span>(name)));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_symbol.html">Symbol</a> symbol(<span class="keywordtype">id</span>, name);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddSymbol(symbol);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add symbol&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add symbol&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> DeleteSymbol(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^delete symbol (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).DeleteSymbol(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;delete symbol&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;delete symbol&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Books */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddOrderBook(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add book (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">char</span> name[8];</div>
<div class="line">        std::memset(name, 0, <span class="keyword">sizeof</span>(name));</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_symbol.html">Symbol</a> symbol(<span class="keywordtype">id</span>, name);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrderBook(symbol);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add book&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add book&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> DeleteOrderBook(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^delete book (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).DeleteOrderBook(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;delete book&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;delete book&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get OrderBook in CSV format</span></div>
<div class="line"><span class="keywordtype">void</span> GetOrderBook(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^get book (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t symbol_id = std::stoi(match[1]);</div>
<div class="line">    </div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="class_cpp_trader_1_1_matching_1_1_order_book.html">OrderBook</a>* order_book_ptr = (*market).GetOrderBook(symbol_id);</div>
<div class="line">        <span class="keywordflow">if</span> (order_book_ptr == NULL)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;get book&#39; command: Book not found&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Get CSV</span></div>
<div class="line">            std::string res = ParseOrderBook(market, order_book_ptr);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Set response to client</span></div>
<div class="line">            <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line">            (*ctx).command.response = res;</div>
<div class="line">            (*ctx).command.response_size = MSG_SIZE_LARGE;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;get book&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Orders: Modify */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ReduceOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^reduce order (\\d+) (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[2]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).ReduceOrder(<span class="keywordtype">id</span>, quantity);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;reduce order&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;reduce order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ModifyOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^modify order (\\d+) (\\d+) (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line">        uint64_t new_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t new_quantity = std::stoi(match[3]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).ModifyOrder(<span class="keywordtype">id</span>, new_price, new_quantity);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;modify order&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;modify order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> MitigateOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^mitigate order (\\d+) (\\d+) (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line">        uint64_t new_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t new_quantity = std::stoi(match[3]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).MitigateOrder(<span class="keywordtype">id</span>, new_price, new_quantity);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;mitigate order&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;mitigate order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ReplaceOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^replace order (\\d+) (\\d+) (\\d+) (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line">        uint64_t new_id = std::stoi(match[2]);</div>
<div class="line">        uint64_t new_price = std::stoi(match[3]);</div>
<div class="line">        uint64_t new_quantity = std::stoi(match[4]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).ReplaceOrder(<span class="keywordtype">id</span>, new_id, new_price, new_quantity);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;replace order&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;replace order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> DeleteOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^delete order (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).DeleteOrder(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;delete order&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;delete order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="comment">// Get Order in CSV format</span></div>
<div class="line"><span class="keywordtype">void</span> GetOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^get order (\\d+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        uint32_t <span class="keywordtype">id</span> = std::stoi(match[1]);</div>
<div class="line">    </div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>* order_ptr = (*market).GetOrder(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (order_ptr == NULL)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;get order&#39; command: Order not found&quot;</span>);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Get CSV</span></div>
<div class="line">            std::string res = (</div>
<div class="line">                CSV_HEADER_FOR_ORDER + CSV_EOL +</div>
<div class="line">                ParseOrder(*order_ptr) + CSV_EOL</div>
<div class="line">            );</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Set response to client</span></div>
<div class="line">            <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line">            (*ctx).command.response = res;</div>
<div class="line">            (*ctx).command.response_size = MSG_SIZE;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;get order&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Orders: Add */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddMarketOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add market (buy|sell) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t quantity = std::stoi(match[2]);</div>
<div class="line">        (*ctx).order.info = match[3];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyMarket(<span class="keywordtype">id</span>, SYMBOL_ID, quantity);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellMarket(<span class="keywordtype">id</span>, SYMBOL_ID, quantity);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid market order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add market&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add market&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddSlippageMarketOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add slippage market (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t quantity = std::stoi(match[2]);</div>
<div class="line">        uint64_t slippage = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyMarket(<span class="keywordtype">id</span>, SYMBOL_ID, quantity, slippage);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellMarket(<span class="keywordtype">id</span>, SYMBOL_ID, quantity, slippage);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid market order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add slippage market&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add slippage market&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add limit (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddIOCLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add ioc limit (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::IOC);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::IOC);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add ioc limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add ioc limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddFOKLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add fok limit (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::FOK);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::FOK);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add fok limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add fok limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddAONLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add aon limit (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::AON);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellLimit(<span class="keywordtype">id</span>, SYMBOL_ID, price, quantity, OrderTimeInForce::AON);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add aon limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add aon limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddStopOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add stop (buy|sell) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t stop_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        (*ctx).order.info = match[4];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyStop(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellStop(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid stop order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add stop&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add stop&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddStopLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add stop-limit (buy|sell) (\\d+) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t stop_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t price = std::stoi(match[3]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[4]);</div>
<div class="line">        (*ctx).order.info = match[5];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::BuyStopLimit(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::SellStopLimit(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, price, quantity);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid stop-limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add stop-limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add stop-limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddTrailingStopOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add trailing stop (buy|sell) (\\d+) (\\d+) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t stop_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[3]);</div>
<div class="line">        int64_t trailing_distance = std::stoi(match[4]);</div>
<div class="line">        int64_t trailing_step = std::stoi(match[5]);</div>
<div class="line">        (*ctx).order.info = match[6];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::TrailingBuyStop(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, quantity, trailing_distance, trailing_step);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::TrailingSellStop(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, quantity, trailing_distance, trailing_step);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid stop order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add trailing stop&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add trailing stop&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> AddTrailingStopLimitOrder(<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market, <span class="keyword">const</span> std::string&amp; command)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">static</span> std::regex pattern(<span class="stringliteral">&quot;^add trailing stop-limit (buy|sell) (\\d+) (\\d+) (\\d+) (\\d+) (\\d+) (.+)$&quot;</span>);</div>
<div class="line">    std::smatch match;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (std::regex_search(command, match, pattern))</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">        uint64_t <span class="keywordtype">id</span> = (*ctx).order.id;</div>
<div class="line">        uint64_t stop_price = std::stoi(match[2]);</div>
<div class="line">        uint64_t price = std::stoi(match[3]);</div>
<div class="line">        uint64_t quantity = std::stoi(match[4]);</div>
<div class="line">        int64_t trailing_distance = std::stoi(match[5]);</div>
<div class="line">        int64_t trailing_step = std::stoi(match[6]);</div>
<div class="line">        (*ctx).order.info = match[7];</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a> order;</div>
<div class="line">        <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;buy&quot;</span>)</div>
<div class="line">            order = Order::TrailingBuyStopLimit(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, price, quantity, trailing_distance, trailing_step);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (match[1] == <span class="stringliteral">&quot;sell&quot;</span>)</div>
<div class="line">            order = Order::TrailingSellStopLimit(<span class="keywordtype">id</span>, SYMBOL_ID, stop_price, price, quantity, trailing_distance, trailing_step);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;Invalid stop-limit order side: &quot;</span> + sstos(&amp;match[1]));</div>
<div class="line">            <span class="keywordflow">return</span>;</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">ErrorCode</a> result = (*market).AddOrder(order);</div>
<div class="line">        <span class="keywordflow">if</span> (result != ErrorCode::OK)</div>
<div class="line">            error(<span class="stringliteral">&quot;Failed &#39;add trailing stop-limit&#39; command: &quot;</span> + sstos(&amp;result));</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    error(<span class="stringliteral">&quot;Invalid &#39;add trailing stop-limit&#39; command: &quot;</span> + command);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Execute Command */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> UpdateOrders()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Generate all update queries</span></div>
<div class="line">    std::string updates;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> <span class="keywordtype">id</span> : (*ctx).market.changes)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">const</span> <a class="code" href="struct_cpp_trader_1_1_matching_1_1_order.html">Order</a>* order = (*(*ctx).market.market_ptr).GetOrder(<span class="keywordtype">id</span>);</div>
<div class="line">        <span class="keywordflow">if</span> (order == NULL) <span class="keywordflow">continue</span>;</div>
<div class="line">        updates.append(UpdateQueryFromOrder(*order) + <span class="stringliteral">&quot;; &quot;</span>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!updates.empty())</div>
<div class="line">    {</div>
<div class="line">        sqlite3* db = (*ctx).connection.sqlite_ptr;</div>
<div class="line">        <span class="keywordtype">char</span>* err;</div>
<div class="line"> </div>
<div class="line">        <span class="keyword">const</span> std::string query = <span class="stringliteral">&quot;BEGIN; &quot;</span> + updates + <span class="stringliteral">&quot;COMMIT;&quot;</span>;</div>
<div class="line">        <span class="keywordtype">int</span> rdy = sqlite3_exec(db, query.c_str(), NULL, NULL, &amp;err);</div>
<div class="line">        <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">        { error(<span class="stringliteral">&quot;sqlite error(7): &quot;</span> + sstos(&amp;err)); };</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Clear changes</span></div>
<div class="line">    (*ctx).market.changes.clear();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> Execute()</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Get Context</span></div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line">    std::string command = (*ctx).command.input;</div>
<div class="line">    <a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a>* market = (*ctx).market.market_ptr;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Exit</span></div>
<div class="line">    <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;exit&quot;</span>) (*ctx).enable = <span class="keyword">false</span>;</div>
<div class="line">    <span class="comment">// Matching</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;enable matching&quot;</span>) (*market).<a name="a30"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html#a4bd7f531ee55fdd76974d75115e18687">EnableMatching</a>();</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command == <span class="stringliteral">&quot;disable matching&quot;</span>) (*market).DisableMatching();</div>
<div class="line">    <span class="comment">// Symbols</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add symbol&quot;</span>) != std::string::npos) AddSymbol(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;delete symbol&quot;</span>) != std::string::npos) DeleteSymbol(market, command);</div>
<div class="line">    <span class="comment">// Books</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add book&quot;</span>) != std::string::npos) AddOrderBook(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;delete book&quot;</span>) != std::string::npos) DeleteOrderBook(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;get book&quot;</span>) != std::string::npos) GetOrderBook(market, command);</div>
<div class="line">    <span class="comment">// Orders: Modify</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;reduce order&quot;</span>) != std::string::npos) ReduceOrder(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;modify order&quot;</span>) != std::string::npos) ModifyOrder(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;mitigate order&quot;</span>) != std::string::npos) MitigateOrder(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;replace order&quot;</span>) != std::string::npos) ReplaceOrder(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;delete order&quot;</span>) != std::string::npos) DeleteOrder(market, command);</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;get order&quot;</span>) != std::string::npos) GetOrder(market, command);</div>
<div class="line">    <span class="comment">// Prepare to Add</span></div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add &quot;</span>) != std::string::npos)</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">// Set new Order Id</span></div>
<div class="line">        (*ctx).order.id = (*(*ctx).market.handler_ptr).lts_order_id() + 1;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Orders: Add</span></div>
<div class="line">        <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add market&quot;</span>) != std::string::npos) AddMarketOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add slippage market&quot;</span>) != std::string::npos) AddSlippageMarketOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add limit&quot;</span>) != std::string::npos) AddLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add ioc limit&quot;</span>) != std::string::npos) AddIOCLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add fok limit&quot;</span>) != std::string::npos) AddFOKLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add aon limit&quot;</span>) != std::string::npos) AddAONLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add stop-limit&quot;</span>) != std::string::npos) AddStopLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add stop&quot;</span>) != std::string::npos) AddStopOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add trailing stop-limit&quot;</span>) != std::string::npos) AddTrailingStopLimitOrder(market, command);</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (command.find(<span class="stringliteral">&quot;add trailing stop&quot;</span>) != std::string::npos) AddTrailingStopOrder(market, command);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update changed orders</span></div>
<div class="line">    <span class="keywordflow">if</span> (!(*ctx).market.changes.empty()) UpdateOrders();</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* Send Response */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> SendResponseIncremental(<span class="keywordtype">int</span> sockfd, <span class="keywordtype">int</span> response_size, std::string response)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Calculate pages</span></div>
<div class="line">    <span class="keywordtype">int</span> content_size = response.size() + 15; <span class="comment">// Add prefix characters</span></div>
<div class="line">    <span class="keywordtype">int</span> pages = (int)content_size / response_size;</div>
<div class="line">    <span class="keywordtype">int</span> rem = content_size % response_size;</div>
<div class="line">    <span class="keywordflow">if</span> (rem &gt; 0) ++pages; <span class="comment">// Add last page</span></div>
<div class="line">    <span class="keywordflow">if</span> ((content_size + pages) &gt; (response_size * pages)) ++pages; <span class="comment">// Add terminator characters</span></div>
<div class="line"> </div>
<div class="line">    std::stringstream ss_pages;</div>
<div class="line">    ss_pages &lt;&lt; std::setw(4) &lt;&lt; std::setfill(<span class="charliteral">&#39;0&#39;</span>) &lt;&lt; pages;</div>
<div class="line">    response = <span class="stringliteral">&quot;PAGES &gt;&gt; &quot;</span> + ss_pages.str() + <span class="charliteral">&#39;\n&#39;</span> + response; <span class="comment">// Add prefix</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Send multiple responses</span></div>
<div class="line">    std::string::iterator it = response.begin();</div>
<div class="line">    std::string::iterator it_end = it;</div>
<div class="line">    <span class="keywordflow">while</span> (<span class="keyword">true</span>) {</div>
<div class="line">        <span class="keywordflow">if</span> (it &gt;= response.end()) <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">if</span> (it_end &gt;= response.end()) <span class="keywordflow">break</span>;</div>
<div class="line"> </div>
<div class="line">        it_end = it + response_size - 1; <span class="comment">// End of page</span></div>
<div class="line">        <span class="keywordflow">if</span> (it_end &gt; response.end()) it_end = response.end();</div>
<div class="line"> </div>
<div class="line">        std::string page(it, it_end); <span class="comment">// Get substring</span></div>
<div class="line"> </div>
<div class="line">        <span class="keywordtype">int</span> rdy = WriteSocketStream(sockfd, response_size, &amp;page);</div>
<div class="line">        <span class="keywordflow">if</span> (rdy &lt; 0) error(<span class="stringliteral">&quot;Failed sending response to client&quot;</span>);</div>
<div class="line">        </div>
<div class="line">        it += response_size; <span class="comment">// Go to next page</span></div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> SendResponse()</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Send response to client</span></div>
<div class="line">    <span class="keywordtype">int</span> sockfd = (*ctx).connection.sockfd;</div>
<div class="line">    std::string response = (*ctx).command.response;</div>
<div class="line">    <span class="keywordtype">int</span> response_size = (*ctx).command.response_size;</div>
<div class="line">    <span class="keywordtype">int</span> content_size = response.size() + 1;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Send multiple responses</span></div>
<div class="line">    <span class="keywordflow">if</span> (content_size &gt; response_size) {</div>
<div class="line">        SendResponseIncremental(sockfd, response_size, response);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">// Send single response</span></div>
<div class="line">        <span class="keywordtype">int</span> rdy = WriteSocketStream(sockfd, response_size, &amp;response);</div>
<div class="line">        <span class="keywordflow">if</span> (rdy &lt; 0) error(<span class="stringliteral">&quot;Failed sending response to client&quot;</span>);</div>
<div class="line">    };</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* CLI */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Parse input args</span></div>
<div class="line">    optparse::OptionParser parser = optparse::OptionParser();</div>
<div class="line">    parser.version(VERSION);</div>
<div class="line">    parser.add_option(<span class="stringliteral">&quot;-n&quot;</span>, <span class="stringliteral">&quot;--name&quot;</span>).dest(<span class="stringliteral">&quot;name&quot;</span>).help(<span class="stringliteral">&quot;Daemon name&quot;</span>);</div>
<div class="line">    parser.add_option(<span class="stringliteral">&quot;-p&quot;</span>, <span class="stringliteral">&quot;--path&quot;</span>).dest(<span class="stringliteral">&quot;path&quot;</span>).help(<span class="stringliteral">&quot;Daemon root folder&quot;</span>);</div>
<div class="line">    optparse::Values options = parser.parse_args(argc, argv);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Print help</span></div>
<div class="line">    <span class="keywordflow">if</span> (options.get(<span class="stringliteral">&quot;help&quot;</span>))</div>
<div class="line">        { parser.print_help(); <span class="keywordflow">return</span> 0; }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check for inputs</span></div>
<div class="line">    <span class="keywordflow">if</span> (!options.is_set(<span class="stringliteral">&quot;name&quot;</span>)) CliError(<span class="stringliteral">&quot;no name provided for daemon&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!options.is_set(<span class="stringliteral">&quot;path&quot;</span>)) CliError(<span class="stringliteral">&quot;no root folder provided&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check root folder</span></div>
<div class="line">    Path root = Path(options.get(<span class="stringliteral">&quot;path&quot;</span>));</div>
<div class="line">    <span class="keywordflow">if</span> (!root.IsDirectory()) CliError(<span class="stringliteral">&quot;invalid path provided as root folder&quot;</span>);</div>
<div class="line">    <span class="keywordflow">else</span> root = root.absolute();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set process name</span></div>
<div class="line">    std::string name;</div>
<div class="line">    name.append(options.get(<span class="stringliteral">&quot;name&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set filepaths</span></div>
<div class="line">    Path log_path = root / Path(name + <span class="stringliteral">&quot;.log&quot;</span>);</div>
<div class="line">    Path err_path = root / Path(name + <span class="stringliteral">&quot;.err&quot;</span>);</div>
<div class="line">    Path status_path = root / Path(name + <span class="stringliteral">&quot;.status&quot;</span>);</div>
<div class="line">    Path socket_path = root / Path(name + <span class="stringliteral">&quot;.sock&quot;</span>);</div>
<div class="line">    Path sqlite_path = root / Path(name + <span class="stringliteral">&quot;.db&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* SETUP */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup status file</span></div>
<div class="line">    <span class="keyword">const</span> std::string status_text = File::ReadAllText(status_path);</div>
<div class="line">    <span class="keywordtype">bool</span> status = socket_path.IsExists() || (status_text != STATUS_GSTOP);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">bool</span> socket_in_use = <span class="keyword">true</span>;</div>
<div class="line">    <span class="keywordtype">int</span> rdy = ConnectUnixSocket(socket_path.string().c_str());</div>
<div class="line">    <span class="keywordflow">if</span> (rdy &lt; 0) socket_in_use = <span class="keyword">false</span>;</div>
<div class="line">    <span class="keywordflow">else</span> close(rdy);</div>
<div class="line">        </div>
<div class="line">    <span class="keywordflow">if</span> (socket_in_use &amp;&amp; (status_text == STATUS_RUN)) CliError(<span class="stringliteral">&quot;SOCKET_IN_USE&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!socket_in_use &amp;&amp; status)</div>
<div class="line">    {</div>
<div class="line">        File::WriteAllText(status_path, STATUS_ABEND);</div>
<div class="line">        Path::Remove(socket_path);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Change process to Daemon</span></div>
<div class="line">    Daemonize(root.string().c_str());</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Stdout and Stderr to log and err files</span></div>
<div class="line">    <span class="keywordflow">if</span> (freopen(log_path.string().c_str(), <span class="stringliteral">&quot;a+&quot;</span>, stdout) == NULL) exit(1);</div>
<div class="line">    <span class="keywordflow">if</span> (freopen(err_path.string().c_str(), <span class="stringliteral">&quot;a+&quot;</span>, stderr) == NULL) exit(1);</div>
<div class="line"> </div>
<div class="line">    log(<span class="stringliteral">&quot;switched to daemon&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize Context</span></div>
<div class="line">    Context::Clear();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Connect to SQLite</span></div>
<div class="line">    sqlite3* db;</div>
<div class="line">    rdy = sqlite3_open(sqlite_path.string().c_str(), &amp;db);</div>
<div class="line">    <span class="keywordflow">if</span> (rdy != SQLITE_OK)</div>
<div class="line">    { error(<span class="stringliteral">&quot;error connecting to sqlite&quot;</span>); exit(1); };</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Setup SQLite</span></div>
<div class="line">    PopulateDatabase(db); <span class="comment">// Create DB Tables</span></div>
<div class="line">    <span class="keywordtype">int</span> lts = GetLatestId(db); <span class="comment">// Get Latest Order Id</span></div>
<div class="line"> </div>
<div class="line">    log(<span class="stringliteral">&quot;connected to sqlite&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initiate MarketManager</span></div>
<div class="line">    MyMarketHandler market_handler(lts);</div>
<div class="line">    <a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html">MarketManager</a> market(market_handler);</div>
<div class="line">    PopulateBook(&amp;market, db, name.c_str()); <span class="comment">// Fill order book from DB</span></div>
<div class="line">    market.<a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html#a4bd7f531ee55fdd76974d75115e18687">EnableMatching</a>(); <span class="comment">// Enable matching</span></div>
<div class="line">    </div>
<div class="line">    <span class="comment">// Create socket</span></div>
<div class="line">    <span class="keywordtype">int</span> sockfd = UnixSocket(socket_path.string().c_str(), MAX_CLIENTS);</div>
<div class="line">    <span class="keywordflow">if</span> (sockfd == -1) { error(<span class="stringliteral">&quot;error creating socket&quot;</span>); exit(1); };</div>
<div class="line">    <span class="keywordflow">if</span> (sockfd == -2) { error(<span class="stringliteral">&quot;error binding socket&quot;</span>); exit(1); };</div>
<div class="line">    <span class="keywordflow">if</span> (sockfd == -3) { error(<span class="stringliteral">&quot;error listening on socket&quot;</span>); exit(1); };</div>
<div class="line"> </div>
<div class="line">    log(<span class="stringliteral">&quot;listening on socket...&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update status file</span></div>
<div class="line">    File::WriteAllText(status_path, STATUS_RUN);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* LOOP */</span></div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> ctx = Context::Get();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Set Constants</span></div>
<div class="line">    (*ctx).market.market_ptr = &amp;market;</div>
<div class="line">    (*ctx).market.handler_ptr = &amp;market_handler;</div>
<div class="line">    (*ctx).connection.sqlite_ptr = db;</div>
<div class="line">    </div>
<div class="line">    std::vector&lt;int&gt; connections = {sockfd}; <span class="comment">// Connection vector</span></div>
<div class="line">    std::vector&lt;int&gt;::iterator it; <span class="comment">// Connection iterator</span></div>
<div class="line">    std::string message;</div>
<div class="line">    <span class="keywordtype">int</span> connfd;</div>
<div class="line"> </div>
<div class="line">    (*ctx).enable = <span class="keyword">true</span>; <span class="comment">// Run condition</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Handle connections</span></div>
<div class="line">    <span class="keywordflow">while</span> ((*ctx).enable)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">try</span></div>
<div class="line">        {</div>
<div class="line">            <span class="comment">// Wait for new connection or message</span></div>
<div class="line">            rdy = SelectVector(&amp;connections);</div>
<div class="line">            <span class="keywordflow">if</span> (rdy &lt; 0) error(<span class="stringliteral">&quot;error waiting for connections&quot;</span>);</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Accept new connection (if available)</span></div>
<div class="line">            connfd = AcceptConnection(sockfd);</div>
<div class="line">            <span class="keywordflow">if</span> (connfd &lt; 0) error(<span class="stringliteral">&quot;error accepting connetion&quot;</span>);</div>
<div class="line">            <span class="keywordflow">if</span> (connfd &gt; 0) connections.push_back(connfd); <span class="comment">// Add connection to vector</span></div>
<div class="line"> </div>
<div class="line">            <span class="comment">// Read messages from all clients (if available)</span></div>
<div class="line">            it = ++connections.begin();</div>
<div class="line">            <span class="keywordflow">while</span> ((it &lt; connections.end()) &amp;&amp; (*ctx).enable)</div>
<div class="line">            {</div>
<div class="line">                rdy = ReadSocketStream(*it, MSG_SIZE, &amp;message); <span class="comment">// Read message</span></div>
<div class="line">                <span class="keywordflow">if</span> (rdy &lt; 0) <span class="comment">// Connection closed</span></div>
<div class="line">                {</div>
<div class="line">                    close(*it);</div>
<div class="line">                    it = connections.erase(it); <span class="comment">// Remove connection from vector</span></div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span> (rdy &gt; 0) <span class="comment">// Message recieved</span></div>
<div class="line">                {</div>
<div class="line">                    <span class="comment">// Update Context</span></div>
<div class="line">                    (*ctx).connection.sockfd = *it;</div>
<div class="line">                    (*ctx).command.input = message;</div>
<div class="line">                    (*ctx).command.response = NULL_STR;</div>
<div class="line"> </div>
<div class="line">                    <span class="comment">// Execute command</span></div>
<div class="line">                    Execute();</div>
<div class="line"> </div>
<div class="line">                    <span class="comment">// Send response to client</span></div>
<div class="line">                    SendResponse();</div>
<div class="line"> </div>
<div class="line">                    <span class="comment">// Clear Context</span></div>
<div class="line">                    (*ctx).connection.sockfd = 0;</div>
<div class="line">                    (*ctx).order = Context::Order();</div>
<div class="line">                    (*ctx).command = Context::Command();</div>
<div class="line">                }</div>
<div class="line">                ++it; <span class="comment">// Update iterator</span></div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">// Catch any error</span></div>
<div class="line">        <span class="keywordflow">catch</span> (std::exception <span class="keyword">const</span>&amp; e)</div>
<div class="line">        {</div>
<div class="line">            error(e.what());</div>
<div class="line">            (*ctx).enable = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">catch</span> (...)</div>
<div class="line">        {</div>
<div class="line">            error(<span class="stringliteral">&quot;unknown error occurred&quot;</span>);</div>
<div class="line">            (*ctx).enable = <span class="keyword">false</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* ############################################################################################################################################# */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* SHUTDOWN */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Graceful shutdown</span></div>
<div class="line">    CloseVector(&amp;connections); <span class="comment">// Close sockets</span></div>
<div class="line">    unlink(socket_path.string().c_str());</div>
<div class="line">    market.<a name="a31"></a><a class="code" href="class_cpp_trader_1_1_matching_1_1_market_manager.html#a06930138a5a90d2f8f79ddeb3941d286">DisableMatching</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update status file</span></div>
<div class="line">    File::WriteAllText(status_path, STATUS_GSTOP);</div>
<div class="line"> </div>
<div class="line">    log(<span class="stringliteral">&quot;graceful shutdown&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* ############################################################################################################################################# */</span></div>
</div><!-- fragment --> </div><!-- contents -->
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a020f762b9b3d40816d3ac083edb5fbec"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a020f762b9b3d40816d3ac083edb5fbec">CppTrader::Matching::Order::IsHidden</a></div><div class="ttdeci">bool IsHidden() const noexcept</div><div class="ttdoc">Is the 'Hidden' order?</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00245">order.h:245</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_market_manager_html_a06930138a5a90d2f8f79ddeb3941d286"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_market_manager.html#a06930138a5a90d2f8f79ddeb3941d286">CppTrader::Matching::MarketManager::DisableMatching</a></div><div class="ttdeci">void DisableMatching()</div><div class="ttdoc">Disable automatic matching.</div><div class="ttdef"><b>Definition:</b> <a href="market__manager_8h_source.html#l00214">market_manager.h:214</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_order_book_html_a613c21ef0c5097641a559032b0d1df3d"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_order_book.html#a613c21ef0c5097641a559032b0d1df3d">CppTrader::Matching::OrderBook::bids</a></div><div class="ttdeci">const Levels &amp; bids() const noexcept</div><div class="ttdoc">Get the order book bids container.</div><div class="ttdef"><b>Definition:</b> <a href="order__book_8h_source.html#l00062">order_book.h:62</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a326726dbed270af12b64bc1eefd42673"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a326726dbed270af12b64bc1eefd42673">CppTrader::Matching::Order::Side</a></div><div class="ttdeci">OrderSide Side</div><div class="ttdoc">Order side.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00136">order.h:136</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_order_book_html"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_order_book.html">CppTrader::Matching::OrderBook</a></div><div class="ttdoc">Order book.</div><div class="ttdef"><b>Definition:</b> <a href="order__book_8h_source.html#l00028">order_book.h:28</a></div></div>
<div class="ttc" id="anamespace_cpp_trader_1_1_matching_html_a1ec2fbd049c2332c538badf16c46b86e"><div class="ttname"><a href="namespace_cpp_trader_1_1_matching.html#a1ec2fbd049c2332c538badf16c46b86e">CppTrader::Matching::ErrorCode</a></div><div class="ttdeci">ErrorCode</div><div class="ttdoc">Error code.</div><div class="ttdef"><b>Definition:</b> <a href="errors_8h_source.html#l00020">errors.h:20</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_order_book_html_ae6b230468dfe944117862f8d80a45f41"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_order_book.html#ae6b230468dfe944117862f8d80a45f41">CppTrader::Matching::OrderBook::Levels</a></div><div class="ttdeci">CppCommon::BinTreeAVL&lt; LevelNode, std::less&lt; LevelNode &gt; &gt; Levels</div><div class="ttdoc">Price level container.</div><div class="ttdef"><b>Definition:</b> <a href="order__book_8h_source.html#l00034">order_book.h:34</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_level_html_a164155ae2b8f0c691be8292c5e39084b"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_level.html#a164155ae2b8f0c691be8292c5e39084b">CppTrader::Matching::Level::Orders</a></div><div class="ttdeci">size_t Orders</div><div class="ttdoc">Level orders.</div><div class="ttdef"><b>Definition:</b> <a href="level_8h_source.html#l00044">level.h:44</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_market_manager_html"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_market_manager.html">CppTrader::Matching::MarketManager</a></div><div class="ttdoc">Market manager.</div><div class="ttdef"><b>Definition:</b> <a href="market__manager_8h_source.html#l00038">market_manager.h:38</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a798b7777f5c575a301c6174af2c23e94"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a798b7777f5c575a301c6174af2c23e94">CppTrader::Matching::Order::LeavesQuantity</a></div><div class="ttdeci">uint64_t LeavesQuantity</div><div class="ttdoc">Order leaves quantity.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00147">order.h:147</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#ab1bdcd3d6bd3dce6d54d0c3bbdcaeeac">CppTrader::Matching::Order::Id</a></div><div class="ttdeci">uint64_t Id</div><div class="ttdoc">Order Id.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00130">order.h:130</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a555135d11f7188cb08d51be8455ada85"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a555135d11f7188cb08d51be8455ada85">CppTrader::Matching::Order::ExecutedQuantity</a></div><div class="ttdeci">uint64_t ExecutedQuantity</div><div class="ttdoc">Order executed quantity.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00145">order.h:145</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a8f9a2bd4403993d06556167258a3ed95"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a8f9a2bd4403993d06556167258a3ed95">CppTrader::Matching::Order::Type</a></div><div class="ttdeci">OrderType Type</div><div class="ttdoc">Order type.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00134">order.h:134</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a50407e3856a81f25cc2da01599f15f02"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a50407e3856a81f25cc2da01599f15f02">CppTrader::Matching::Order::TrailingStep</a></div><div class="ttdeci">int64_t TrailingStep</div><div class="ttdoc">Order trailing step.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00198">order.h:198</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a0cd1433ebde9773d0c084dc094fc2b51"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a0cd1433ebde9773d0c084dc094fc2b51">CppTrader::Matching::Order::IsIceberg</a></div><div class="ttdeci">bool IsIceberg() const noexcept</div><div class="ttdoc">Is the 'Iceberg' order?</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00247">order.h:247</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_symbol_html"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_symbol.html">CppTrader::Matching::Symbol</a></div><div class="ttdoc">Symbol.</div><div class="ttdef"><b>Definition:</b> <a href="symbol_8h_source.html#l00021">symbol.h:21</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a8780a90b1a61f2866eb78182e306db12"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a8780a90b1a61f2866eb78182e306db12">CppTrader::Matching::Order::StopPrice</a></div><div class="ttdeci">uint64_t StopPrice</div><div class="ttdoc">Order stop price.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00140">order.h:140</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_market_handler_html"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_market_handler.html">CppTrader::Matching::MarketHandler</a></div><div class="ttdoc">Market handler class.</div><div class="ttdef"><b>Definition:</b> <a href="market__handler_8h_source.html#l00032">market_handler.h:32</a></div></div>
<div class="ttc" id="amarket__manager_8h_html"><div class="ttname"><a href="market__manager_8h.html">market_manager.h</a></div><div class="ttdoc">Market manager definition.</div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a38c3dbc9e2e9ca4d91827a7f3a195dc7"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a38c3dbc9e2e9ca4d91827a7f3a195dc7">CppTrader::Matching::Order::Price</a></div><div class="ttdeci">uint64_t Price</div><div class="ttdoc">Order price.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00138">order.h:138</a></div></div>
<div class="ttc" id="anamespace_cpp_trader_1_1_matching_html"><div class="ttname"><a href="namespace_cpp_trader_1_1_matching.html">CppTrader::Matching</a></div><div class="ttdoc">Matching engine definitions.</div><div class="ttdef"><b>Definition:</b> <a href="errors_8h_source.html#l00017">errors.h:17</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_ae3c50002ba4f8486d6e288e4cee9d0fa"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#ae3c50002ba4f8486d6e288e4cee9d0fa">CppTrader::Matching::Order::Slippage</a></div><div class="ttdeci">uint64_t Slippage</div><div class="ttdoc">Market order slippage.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00179">order.h:179</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_order_book_html_a5dc10173d986f48d519c5da0e4d8d29b"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_order_book.html#a5dc10173d986f48d519c5da0e4d8d29b">CppTrader::Matching::OrderBook::asks</a></div><div class="ttdeci">const Levels &amp; asks() const noexcept</div><div class="ttdoc">Get the order book asks container.</div><div class="ttdef"><b>Definition:</b> <a href="order__book_8h_source.html#l00064">order_book.h:64</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a3d51591547fdb6db893771bf0f00d118"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a3d51591547fdb6db893771bf0f00d118">CppTrader::Matching::Order::MaxVisibleQuantity</a></div><div class="ttdeci">uint64_t MaxVisibleQuantity</div><div class="ttdoc">Order max visible quantity.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00162">order.h:162</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_node_html"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order_node.html">CppTrader::Matching::OrderNode</a></div><div class="ttdoc">Order node.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00301">order.h:301</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_ad78901a32671682eb2e829e73e5a6839"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#ad78901a32671682eb2e829e73e5a6839">CppTrader::Matching::Order::SymbolId</a></div><div class="ttdeci">uint32_t SymbolId</div><div class="ttdoc">Symbol Id.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00132">order.h:132</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_aeb6dd457fd9f343d0f9da913cc1f199c"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#aeb6dd457fd9f343d0f9da913cc1f199c">CppTrader::Matching::Order::Quantity</a></div><div class="ttdeci">uint64_t Quantity</div><div class="ttdoc">Order quantity.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00143">order.h:143</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_aacaa8f37a245bb45e4fc1e1372517920"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#aacaa8f37a245bb45e4fc1e1372517920">CppTrader::Matching::Order::TrailingDistance</a></div><div class="ttdeci">int64_t TrailingDistance</div><div class="ttdoc">Order trailing distance to market.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00189">order.h:189</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html">CppTrader::Matching::Order</a></div><div class="ttdoc">Order.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00127">order.h:127</a></div></div>
<div class="ttc" id="anamespace_cpp_trader_1_1_matching_html_a3c4a6bd3748dd98d9daff8e5c40b2b9a"><div class="ttname"><a href="namespace_cpp_trader_1_1_matching.html#a3c4a6bd3748dd98d9daff8e5c40b2b9a">CppTrader::Matching::OrderTimeInForce</a></div><div class="ttdeci">OrderTimeInForce</div><div class="ttdoc">Order Time in Force.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00109">order.h:109</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_level_node_html"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_level_node.html">CppTrader::Matching::LevelNode</a></div><div class="ttdoc">Price level node.</div><div class="ttdef"><b>Definition:</b> <a href="level_8h_source.html#l00078">level.h:78</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_level_html"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_level.html">CppTrader::Matching::Level</a></div><div class="ttdoc">Price level.</div><div class="ttdef"><b>Definition:</b> <a href="level_8h_source.html#l00031">level.h:31</a></div></div>
<div class="ttc" id="anamespace_cpp_trader_1_1_matching_html_a3f665b3bd035eb7a647258ce0ca1dd43"><div class="ttname"><a href="namespace_cpp_trader_1_1_matching.html#a3f665b3bd035eb7a647258ce0ca1dd43">CppTrader::Matching::OrderType</a></div><div class="ttdeci">OrderType</div><div class="ttdoc">Order type.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00081">order.h:81</a></div></div>
<div class="ttc" id="anamespace_cpp_trader_1_1_matching_html_a07e8bfcb84f50475ba6ca9d29a6ca668"><div class="ttname"><a href="namespace_cpp_trader_1_1_matching.html#a07e8bfcb84f50475ba6ca9d29a6ca668">CppTrader::Matching::OrderSide</a></div><div class="ttdeci">OrderSide</div><div class="ttdoc">Order side.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00033">order.h:33</a></div></div>
<div class="ttc" id="aclass_cpp_trader_1_1_matching_1_1_market_manager_html_a4bd7f531ee55fdd76974d75115e18687"><div class="ttname"><a href="class_cpp_trader_1_1_matching_1_1_market_manager.html#a4bd7f531ee55fdd76974d75115e18687">CppTrader::Matching::MarketManager::EnableMatching</a></div><div class="ttdeci">void EnableMatching()</div><div class="ttdoc">Enable automatic matching.</div><div class="ttdef"><b>Definition:</b> <a href="market__manager_8h_source.html#l00212">market_manager.h:212</a></div></div>
<div class="ttc" id="astruct_cpp_trader_1_1_matching_1_1_order_html_a9f0f38e28183909ed38c970ad9c8f96c"><div class="ttname"><a href="struct_cpp_trader_1_1_matching_1_1_order.html#a9f0f38e28183909ed38c970ad9c8f96c">CppTrader::Matching::Order::TimeInForce</a></div><div class="ttdeci">OrderTimeInForce TimeInForce</div><div class="ttdoc">Time in Force.</div><div class="ttdef"><b>Definition:</b> <a href="order_8h_source.html#l00150">order.h:150</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
